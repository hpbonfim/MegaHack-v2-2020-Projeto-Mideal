(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{SoNV:function(t,c,o){"use strict";o.r(c),o.d(c,"UserContractModule",(function(){return P}));var n=o("ofXK"),e=o("Wp6s"),r=o("tyNb"),a=o("PSD3"),s=o.n(a),i=o("ISmH"),l=o("aaHD"),u=o("fXoL"),b=o("k9EJ"),d=o("FXLl"),f=o("tk/3");let p=(()=>{class t extends d.a{constructor(t){super(t),this.API_URL="function/encrypt"}}return t.\u0275fac=function(c){return new(c||t)(u.Wb(f.b))},t.\u0275prov=u.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var h=o("4jKo"),m=o("w+uN"),v=o("mrSG");class g{}var C=o("3Pt+"),S=o("cYo0"),y=o("XiUz"),N=o("bTqV"),k=o("NFeN"),I=o("kmnG"),O=o("qFsG");function w(t,c){if(1&t&&(u.Sb(0,"div"),u.Sb(1,"mat-form-field",5),u.Sb(2,"mat-label"),u.vc(3),u.Rb(),u.Ob(4,"input",6),u.Sb(5,"mat-error"),u.vc(6,"Campo obrigat\xf3rio"),u.Rb(),u.Rb(),u.Rb()),2&t){const t=c.$implicit;u.Bb(3),u.wc(t.label),u.Bb(1),u.hc("formControlName",t.controlName)}}function R(t,c){if(1&t&&(u.Sb(0,"div"),u.uc(1,w,7,2,"div",3),u.Rb()),2&t){const t=c.$implicit;u.Bb(1),u.hc("ngForOf",t.controls)}}let F=(()=>{class t{constructor(t){this.contractService=t,this.contract=new g,this.setContractIsFilled=new u.n,this.serviceContract=Object.assign({},l.a),this.handleSubmit=()=>{Object(S.a)(this.form),this.form.invalid||(this.blocks.forEach(t=>{const c=t.controls.map(t=>({key:`{${t.controlName}:${t.label}}`,value:this.form.get(t.controlName).value}));this.contractService.fillBlock(t.blockTitle,c)}),this.setContractIsFilled.emit())}}ngOnInit(){this.createForm()}createForm(){return Object(v.a)(this,void 0,void 0,(function*(){this.form=new C.d({}),this.blocks=yield this.getContractInputs(),this.blocks.forEach(t=>{t.controls.forEach(t=>{this.form.addControl(t.controlName,new C.b("",C.n.required))})})}))}getContractInputs(){const t=[];return this.contract.blocks.forEach(c=>{const o=c.description.match(/\{([^}]+)\}/g);if(o){const n=o.map(t=>{const[c,o]=t.replace(/\{|\}/g,"").split(":");return{controlName:c,label:o}});t.push({blockTitle:c.title,controls:n})}}),t}}return t.\u0275fac=function(c){return new(c||t)(u.Nb(b.a))},t.\u0275cmp=u.Hb({type:t,selectors:[["app-contract-infos"]],inputs:{contract:"contract"},outputs:{setContractIsFilled:"setContractIsFilled"},decls:11,vars:2,consts:[["fxLayout","column","fxLayoutAlign","start stretch"],[1,"w-100",3,"formGroup"],["fxLayout","column"],[4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",1,"btn-accent",3,"click"],["appearance","outline","color","primary",1,"w-100"],["type","text","ngDefaultControl","","matInput","",3,"formControlName"]],template:function(t,c){1&t&&(u.Sb(0,"div",0),u.Sb(1,"strong"),u.vc(2,"Informa\xe7\xf5es do contrato:"),u.Rb(),u.Ob(3,"br"),u.Sb(4,"form",1),u.Sb(5,"div",2),u.uc(6,R,2,1,"div",3),u.Rb(),u.Rb(),u.Sb(7,"button",4),u.ac("click",(function(){return c.handleSubmit()})),u.vc(8," Visualizar contrato "),u.Sb(9,"mat-icon"),u.vc(10,"forward"),u.Rb(),u.Rb(),u.Rb()),2&t&&(u.Bb(4),u.hc("formGroup",c.form),u.Bb(2),u.hc("ngForOf",c.blocks))},directives:[y.c,y.b,C.o,C.k,C.e,n.i,N.a,k.a,I.b,I.e,O.a,C.a,C.j,C.c,I.a],styles:[""]}),t})();var x=o("/v5Z");function B(t,c){if(1&t&&u.Ob(0,"app-contract-card",5),2&t){const t=u.cc();u.hc("contract",t.model)("selected",!0)}}function T(t,c){if(1&t){const t=u.Tb();u.Sb(0,"app-contract-infos",6),u.ac("setContractIsFilled",(function(){return u.nc(t),u.cc().filledContract=!0})),u.Rb()}if(2&t){const t=u.cc();u.hc("contract",t.contract)}}function j(t,c){if(1&t){const t=u.Tb();u.Sb(0,"app-contract-generator",7),u.ac("handleSubmit",(function(){return u.nc(t),u.cc().encryptContract()}))("goBack",(function(){return u.nc(t),u.cc().filledContract=!1})),u.Rb()}}const L=[{path:"",component:(()=>{class t{constructor(t,c,o,n,e){this.activatedRoute=t,this.contractService=c,this.contractEncryptService=o,this.userDataService=n,this.router=e,this.models=i.a,this.contract=Object.assign({},l.a),this.encryptContract=()=>{const t=this.contractService.getContract(),{phoneNumber:c,stateCode:o,fullName:n,countryCode:e,_id:r}=this.userDataService.getUserData(),a={fullName:n,payload:JSON.stringify(t),phoneNumber:`${e||"55"}${o}${c}`};this.contractEncryptService.post(a).subscribe(c=>{this.saveContract(t,c._id,r),s.a.fire("Sucesso","Contrato enviado com sucesso! Foi enviado uma mensagem de texto a todas as partes envolvida com a senha de acesso para acompanhamento","success").then(()=>{this.goToMyContracts()})})}}ngOnInit(){const{id:t}=this.activatedRoute.snapshot.params;this.fillModel(t)}saveContract(t,c,o){const n=Object.assign({},t);n.title=this.getOnlyText(n.title),n.description=this.getOnlyText(n.description),n.id=c,n.userId=o,delete n.blocks,this.contractService.createContract(n)}fillModel(t){this.model=i.a.find(c=>c.id===+t)}goToMyContracts(){this.router.navigate(["user-shell"],{queryParams:{goTo:"myContracts"}})}getOnlyText(t){const c=t.indexOf("<strong>"),o=t.indexOf("</strong>");return t.substring(c,o)}}return t.\u0275fac=function(c){return new(c||t)(u.Nb(r.a),u.Nb(b.a),u.Nb(p),u.Nb(h.a),u.Nb(r.b))},t.\u0275cmp=u.Hb({type:t,selectors:[["app-user-contract"]],decls:5,vars:3,consts:[[1,"content"],[1,"card"],[3,"contract","selected",4,"ngIf"],[3,"contract","setContractIsFilled",4,"ngIf"],[3,"handleSubmit","goBack",4,"ngIf"],[3,"contract","selected"],[3,"contract","setContractIsFilled"],[3,"handleSubmit","goBack"]],template:function(t,c){1&t&&(u.Sb(0,"div",0),u.Sb(1,"div",1),u.uc(2,B,1,2,"app-contract-card",2),u.Rb(),u.uc(3,T,1,1,"app-contract-infos",3),u.uc(4,j,1,0,"app-contract-generator",4),u.Rb()),2&t&&(u.Bb(2),u.hc("ngIf",c.model),u.Bb(1),u.hc("ngIf",!c.filledContract),u.Bb(1),u.hc("ngIf",c.filledContract))},directives:[n.j,m.a,F,x.a],styles:[".container[_ngcontent-%COMP%]{height:100vh;background-color:#e5e5e5}.content[_ngcontent-%COMP%]{padding:20px}"]}),t})()}];let E=(()=>{class t{}return t.\u0275mod=u.Lb({type:t}),t.\u0275inj=u.Kb({factory:function(c){return new(c||t)},imports:[[r.e.forChild(L)],r.e]}),t})();var M=o("PCNd");let P=(()=>{class t{}return t.\u0275mod=u.Lb({type:t}),t.\u0275inj=u.Kb({factory:function(c){return new(c||t)},imports:[[n.b,E,M.a,e.a]]}),t})()}}]);